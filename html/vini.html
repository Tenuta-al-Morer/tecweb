<!DOCTYPE html>
<html lang="it">

    <head>
        <meta charset="utf-8">
        <title>I Vini - Tenuta al Morer</title>
        <link rel="icon" href="../../images/logo.ico" type="image/x-icon"> 

        <meta name="description" content="Scopri i vini pregiati della Tenuta al Morer, selezione di etichette tradizionali venete prodotte con passione nelle nostre colline.">
        <meta name="keywords" content="vini, Tenuta al Morer, vini veneti, viticoltura, degustazione">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        
        <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet"> 
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="../../style/stile.css" media="screen"> 
        <link rel="stylesheet" href="../../style/mini.css" media="screen and (max-width:940px)"> 
        <link rel="stylesheet" href="../../style/stampa.css" media="print">  
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
        
        <link rel="stylesheet" href="../../style/vini.css" media="screen"> 
    </head>

    <body> 
        <header>
            <nav id="help">
                <h2 class="visually-hidden">Aiuti alla navigazione</h2>
                <a class="navigationHelp" href="#content">Vai al contenuto</a>
            </nav>

            <div class="main-nav-bar">    
                <button class="menu-toggle" aria-controls="main-navigation" aria-expanded="false">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                    <span class="visually-hidden">Apri il menu di navigazione</span>
                </button>

                <a href="home.php" class="logo-link">
                    <img src="../../images/logo.webp" alt="Torna alla Home - Tenuta al Morer">
                </a>

                <nav id="main-navigation" class="primary-navigation">
                    <ul>
                        <li><a href="home.php"><span lang="en">Home</span></a></li> 
                        <li><a href="tenuta.php">Tenuta</a></li>
                        <li><span aria-current="page">Vini</span></li>
                        <li><a href="esperienze.php">Esperienze</a></li>
                        <li><a href="contatti.php">Contatti</a></li>
                    </ul>
                </nav>

                <div class="mobile-icons">
                    <a href="carrello.php">
                        <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                        <span class="visually-hidden" lang="en">Shop</span>
                    </a>
                    
                    [user_area_link]
                    
                </div>
            </div>

            <div class="sub-header">
                <nav id="breadcrumb">
                    <div class="breadcrumb-container">
                        <span>Ti trovi in: </span>
                        <a href="home.php"><span class="visually-hidden" lang="en">Home</span><i class="fas fa-home home-icon" aria-hidden="true"></i></a><span aria-hidden="true"> &gt; </span> 
                        <span class="current-page">I vini</span><i class="fas fa-wine-glass wine-icon" aria-hidden="true"></i> 
                    </div>
                </nav>

                <button id="theme-toggle" aria-label="Cambia tema">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
            </div>
        </header>

        <main class="vini-main" aria-labelledby="vini-title">
            <section class="tenuta-hero">
                <div class="tenuta-hero-inner vini-hero-inner"> 
                    <h1 class="tenuta-hero-title">Scopri la nostra collezione di vini</h1>
                    <p class="tenuta-hero-text">
                        Dalle nostre vigne alle vostre tavole, proponiamo vini che uniscono tradizione, qualità e rispetto per la terra.<br>Un percorso fatto di dedizione, pensato per valorizzare ogni carattere del territorio.
                    </p>
                </div>
            </section>

            <section class="wine-section">
                    <section id="red-wines">
                        <div class="section-intro"> 
                            <h2 class="tenuta-section-title">Vini Rossi</h2>
                            <p class="lead">Vini dal carattere deciso, espressione della nostra terra e della sua autenticità.</p>
                        </div>
                        
                        <div class="sezione">
                            [vini_rossi]
                        </div>
                    </section>

                <div class="tenuta-separator"></div>

                    <section id="white-wines">
                        <div class="section-intro"> 
                            <h2 class="tenuta-section-title">Vini Bianchi</h2>
                            <p class="lead">Freschezza, armonia e profumi che raccontano le terre del Piave.</p>
                        </div>
                        
                        <div class="sezione">
                            [vini_bianchi]
                        </div>
                    </section>

                <div class="tenuta-separator"></div>

                    <section id="premium-wines">
                        <div class="section-intro"> 
                            <h2 class="tenuta-section-title">"La Selezione"</h2>
                            <p class="lead">Le nostre etichette più pregiate, frutto di cura, esperienza e passione.</p>
                        </div>
                        
                        <div class="sezione">
                            [vini_selezione]
                        </div>
                    </section>
            </section>
        </main>

        <footer>
            <div class="footer-content">
                <small>
                    &copy; 2025 Tenuta al Morer - <abbr title="Partita">P.</abbr> <abbr title="Imposta sul Valore Aggiunto">IVA</abbr> 00000000000 <br>
                    <a href="policy.php"><span lang="en">Privacy Policy</span></a> | 
                    <a href="policy.php#privacy-policy"><span lang="en">Cookie Policy</span></a> | 
                    <a href="policy.php#accessibility">Accessibilità</a>
                </small>
            </div>
        </footer>

        <button id="backToTopBtn" aria-label="Torna all'inizio della pagina">
            <svg viewBox="0 0 24 24" class="arrow-icon" aria-hidden="true">
                <path d="M12 5 L12 19 M5 12 L12 5 L19 12" stroke="white" stroke-width="2.2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>

        <div id="overlay-dettagli" class="overlay" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="pop-titolo">
            
            <div class="popup-content">
                <button class="close-btn" onclick="chiudiDettagli()" aria-label="Chiudi finestra dettagli">
                    &times;
                </button>
                
                <div class="popup-grid">
                    <div class="popup-gallery">
                        <div class="gallery-container">
                            <button class="nav-arrow prev" onclick="cambiaSlide(-1)" aria-label="Immagine precedente">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            
                            <div class="main-img-box">
                                <img id="pop-img" src="" alt="Dettaglio Vino">
                            </div>

                            <button class="nav-arrow next" onclick="cambiaSlide(1)" aria-label="Immagine successiva">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        
                        <div class="thumbnails-row">
                            <img id="thumb-0" src="" onclick="vaiAllaSlide(0)" alt="Vista Fronte" class="active-thumb" tabindex="0">
                            <img id="thumb-1" src="" onclick="vaiAllaSlide(1)" alt="Vista Retro" tabindex="0">
                            <img id="thumb-2" src="" onclick="vaiAllaSlide(2)" alt="Dettaglio Etichetta" tabindex="0">
                        </div>
                    </div>
                    
                    <div class="popup-info">
                        <h2 id="pop-titolo" tabindex="-1"></h2>
                        
                        <p id="pop-descrizione"></p>

                        <div class="tech-wrapper">
                            <table class="wine-table">
                                <caption>Scheda Tecnica</caption>
                                <tbody>
                                    <tr>
                                        <th scope="row">Vitigno</th>
                                        <td id="tab-vitigno">-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Annata</th>
                                        <td id="tab-annata">-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Gradazione</th>
                                        <td id="tab-grado">-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Temperatura</th>
                                        <td id="tab-temp">-</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Abbinamenti</th>
                                        <td id="tab-abbinamenti">-</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <p class="pop-prezzo">Prezzo: <span id="pop-prezzo"></span>€</p>
                        
                        <div class="shop-ov">
                            <div class="selettore-quantita">
                                    <button type="button" onclick="aggiornaQuantita(this, -1)" aria-label="Diminuisci quantità">-</button>
                                    <input type="number" class="input-qty" value="1" min="1" readonly aria-label="Quantità da acquistare">
                                    <button type="button" onclick="aggiornaQuantita(this, 1)" aria-label="Aumenta quantità">+</button>
                            </div>
                            <button class="buy-button" onclick="gestisciCarrelloPopup()">Aggiungi al Carrello</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        
        <script src="../javascript/script.js"></script>

        <script>
            // VARIABILI GLOBALI
            let currentSlideIndex = 0;
            let slideImages = [];
            let lastFocusedElement;
            let scrollPosition = 0;
            
            // NUOVA VARIABILE: Serve per ricordare quale vino è aperto nel popup
            let currentOpenWineId = 0; 

            // --- NUOVA FUNZIONE: Aggiunge dal bottone "Acquista" nella lista ---
            function aggiungiDaCard(idVino) {
                // Recupera la quantità dall'input specifico di quella card
                const inputQty = document.getElementById('qty-' + idVino);
                const quantita = inputQty ? inputQty.value : 1;
                
                // Reindirizza alla pagina che fa il lavoro sporco
                inviaAlCarrello(idVino, quantita);
            }

            // --- NUOVA FUNZIONE: Aggiunge dal bottone nel Popup Dettagli ---
            function gestisciCarrelloPopup() {
                // Recupera la quantità dall'input dentro il popup
                const qtyInput = document.querySelector('.shop-ov .input-qty');
                const quantita = qtyInput ? qtyInput.value : 1;
                
                if(currentOpenWineId > 0) {
                    inviaAlCarrello(currentOpenWineId, quantita);
                    
                    // Resetta a 1 dopo l'aggiunta (estetica)
                    if(qtyInput) qtyInput.value = 1;
                    chiudiDettagli();
                } else {
                    console.error("ID Vino non trovato nel popup");
                }
            }

            // --- FUNZIONE COMUNE PER IL REDIRECT ---
            function inviaAlCarrello(id, qty) {
                // Costruisce l'URL: carrello.php?action=aggiungi&id_vino=1&quantita=2
                const url = `carrello.php?action=aggiungi&id_vino=${id}&quantita=${qty}`;
                window.location.href = url;
            }

            // APERTURA POPUP (Aggiornata per leggere l'ID)
            function apriDettagli(bottone) {
                scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
                lastFocusedElement = bottone;

                const articolo = bottone.closest('.wine-article');
                
                // RECUPERO DATI HTML
                // Nota: ora leggiamo anche dataset.id che abbiamo aggiunto nel PHP
                currentOpenWineId = articolo.dataset.id; 
                const nome = articolo.dataset.nome;
                const desc = articolo.dataset.descrizione;
                const img = articolo.dataset.img;
                const prezzo = articolo.dataset.prezzo;

                // Recupera dati dal div nascosto
                const hiddenData = articolo.querySelector('.hidden-data');
                const vitigno = hiddenData.querySelector('[data-key="vitigno"]').innerText;
                const annata = hiddenData.querySelector('[data-key="annata"]').innerText;
                const gradazione = hiddenData.querySelector('[data-key="gradazione"]').innerText;
                const temperatura = hiddenData.querySelector('[data-key="temperatura"]').innerText;
                const abbinamenti = hiddenData.querySelector('[data-key="abbinamenti"]').innerText;

                // Popola campi interfaccia
                document.getElementById('pop-titolo').innerText = nome;
                document.getElementById('pop-descrizione').innerText = desc;
                document.getElementById('pop-prezzo').innerText = prezzo;
                
                document.getElementById('tab-vitigno').innerText = vitigno;
                document.getElementById('tab-annata').innerText = annata;
                document.getElementById('tab-grado').innerText = gradazione;
                document.getElementById('tab-temp').innerText = temperatura;
                document.getElementById('tab-abbinamenti').innerText = abbinamenti;
                
                // Reset quantità popup a 1 ogni volta che apri
                const popupQty = document.querySelector('.shop-ov .input-qty');
                if(popupQty) popupQty.value = 1;

                // Gestione Immagini
                slideImages = [img, img, img]; 
                currentSlideIndex = 0;
                updateGalleryView();

                const overlay = document.getElementById('overlay-dettagli');
                overlay.style.display = 'flex';
                
                document.body.classList.add('no-scroll');
                document.body.style.top = `-${scrollPosition}px`;

                setTimeout(() => {
                    const closeBtn = overlay.querySelector('.close-btn');
                    if (closeBtn) closeBtn.focus();
                }, 100);
            }

            // CHIUSURA POPUP
            function chiudiDettagli() {
                const overlay = document.getElementById('overlay-dettagli');
                overlay.style.display = 'none';
                
                document.body.classList.remove('no-scroll');
                document.body.style.top = '';
                window.scrollTo(0, scrollPosition);

                if (lastFocusedElement) lastFocusedElement.focus();
            }

            // GESTIONE QUANTITÀ + -
            function aggiornaQuantita(bottone, variazione) {
                const parent = bottone.parentElement;
                const input = parent.querySelector('.input-qty');
                let valore = parseInt(input.value);
                let nuovoValore = valore + variazione;
                
                if (nuovoValore >= 1) {
                    input.value = nuovoValore;
                }
            }

            // GALLERIA IMMAGINI
            function cambiaSlide(direzione) {
                currentSlideIndex += direzione;
                if (currentSlideIndex >= slideImages.length) currentSlideIndex = 0;
                else if (currentSlideIndex < 0) currentSlideIndex = slideImages.length - 1;
                updateGalleryView();
            }

            function vaiAllaSlide(index) {
                currentSlideIndex = index;
                updateGalleryView();
            }

            function updateGalleryView() {
                const mainImg = document.getElementById('pop-img');
                if(mainImg) mainImg.src = slideImages[currentSlideIndex];
                
                const t0 = document.getElementById('thumb-0');
                const t1 = document.getElementById('thumb-1');
                const t2 = document.getElementById('thumb-2');
                
                if(t0) t0.src = slideImages[0];
                if(t1) t1.src = slideImages[1];
                if(t2) t2.src = slideImages[2];

                document.querySelectorAll('.thumbnails-row img').forEach(img => img.classList.remove('active-thumb'));
                const activeThumb = document.getElementById('thumb-' + currentSlideIndex);
                if(activeThumb) activeThumb.classList.add('active-thumb');
            }
        </script>

    </body>
</html>